<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Загрузка поздравления</title>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
 
        ym(99216022, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true
        });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/99216022" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->    
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            background: linear-gradient(to bottom, #001833, #003f7f);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #fff;
            position: relative;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        /* Декор рамки */
        .top-decoration, .bottom-decoration {
            position: fixed;
            width: 100%;
            height: 80px;
            z-index: 5;
            pointer-events: none;
            left: 0;
        }

        .top-decoration {
            top: 0;
            position: fixed;
        }

        .bottom-decoration {
            bottom: 0;
            position: fixed;
        }

        .top-decoration span, .bottom-decoration span {
            position: absolute;
            user-select: none;
            animation: blink 1.5s infinite;
        }

        /* Разные задержки для разных символов */
        .top-decoration span:nth-child(3n) {
            animation-delay: 0.5s;
        }
        .top-decoration span:nth-child(3n+1) {
            animation-delay: 1s;
        }
        .bottom-decoration span:nth-child(3n) {
            animation-delay: 0.5s;
        }
        .bottom-decoration span:nth-child(3n+1) {
            animation-delay: 1s;
        }

        .spinner {
            margin-bottom: 20px;
            width: 50px;
            height: 50px;
            border: 6px solid rgba(255,255,255,0.3);
            border-top: 6px solid #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            z-index: 1;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.4em;
            margin-bottom: 20px;
            text-shadow: 0 0 5px rgba(255,255,255,0.5);
            z-index: 1;
            text-align: center;
        }

        .progress-container {
            width: 80%;
            max-width: 400px;
            background: rgba(255,255,255,0.2);
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
            position: relative;
            z-index: 1;
        }

        .progress-bar-green {
            height: 100%;
            background: linear-gradient(to right, #4caf50, #8bc34a);
            width: 0;
            transition: width 0.2s;
        }
        .progress-bar-blue {
            height: 100%;
            background: linear-gradient(to right, #005afd, #293081);
            width: 0%;
            transition: width 0.2s;
        }
        .progress-bar-yellow {
            height: 100%;
            background: linear-gradient(to right, #ffeb00, #978329);
            width: 0%;
            transition: width 0.2s;
        }
        .progress-bar-red {
            height: 100%;
            background: linear-gradient(to right, #ea0505, #812f30);
            width: 0%;
            transition: width 0.2s;
        }

        .progress-percentage {
            text-align: center;
            width: 100%;
            line-height: 20px;
            position: absolute;
            color: #fff;
            font-size: 0.9em;
            text-shadow: 0 0 2px rgba(0,0,0,0.5);
        }

        /* Кнопка ускорения и сообщение о поломке */
        .buttons-container {
            position: relative;
            margin-bottom: 40px;
            z-index: 1;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            gap: 10px;
        }

        .custom-button {
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: transform 0.2s;
            color: white;
            font-size: 1em;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
            text-shadow: 0 0 2px rgba(0,0,0,0.5);
            white-space: nowrap;
            margin: 0;
        }

        .custom-button:hover {
            transform: scale(1.1) translateX(0);
        }

        .custom-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: translateX(0) !important;
        }

        /* Градиенты для разных типов кнопок */
        .green-gradient {
            background: linear-gradient(45deg, #65e665, #077907);
        }
        .blue-gradient {
            background: linear-gradient(45deg, #4a54e2, #0f0c99);
        }
        .red-gradient {
            background: linear-gradient(45deg, #f16a6a, #9b0505);
        }
        .pink-gradient {
            background: linear-gradient(45deg, #ea86d8, #770477);
        }
        .yellow-gradient {
            background: linear-gradient(45deg, #ffeb00, #978329);
        }
        .orange-gradient {
            background: linear-gradient(45deg, #ff7f00, #978329);
        }

        .button-bounce {
            animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .changeColor-button {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(45deg, #ea86d8, #c5070e);
            border: none;
            border-radius: 20px;
            color: #fff;
            font-size:1em;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
            text-shadow: 0 0 2px rgba(0,0,0,0.5);
            transition: transform 0.2s;
        }

        .accelerate-message {
            display: none;
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #ff7f7f, #ffa07f);
            color: #fff;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.9em;
            margin-top:5px;
            white-space: nowrap;
            box-shadow:0 0 5px rgba(0,0,0,0.3);
        }

        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0,0,0,0.6);
            color: #fff;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            height: 30px;
            padding: 0 10px;
            box-sizing: border-box;
            z-index: 10;
        }

        .status-text {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .status-progress-container {
            width: 200px;
            background: rgba(255,255,255,0.2);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin-left: 10px;
            position: relative;
        }

        .status-progress-bar {
            height: 100%;
            background: #ffeb3b;
            width: 0;
            transition: width linear;
        }

        /* Счётчик снежинок */
        .snowflake-counter {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1.2em;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .snowflake-counter .icon {
            font-size: 1.4em;
        }

        .snowflake-counter .count {
            min-width: 40px;
            text-align: right;
        }

        /* Анимация для счётчика */
        @keyframes countPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        .count-pop {
            animation: countPop 0.3s ease-out;
        }

        /* Снежинки */
        .snowflake {
            position: fixed;
            top: -10px;
            color: #fff;
            font-size: 1em;
            opacity: 0.8;
            pointer-events: auto;
            cursor: pointer;
            animation: snowfall linear infinite;
            z-index: 5;
        }

        @keyframes snowfall {
            0% {
                transform: translateY(-10px) translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateY(110vh) translateX(0);
                opacity: 0.5;
            }
        }

        /* Взрыв снежинки */
        .explosion {
            position: fixed;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, #fff 0%, rgba(255,255,255,0) 80%);
            border-radius: 50%;
            pointer-events: none;
            animation: explode 0.5s forwards;
            z-index: 5;
        }
        @keyframes explode {
            0% {transform: scale(0.5); opacity:1;}
            100% {transform: scale(3); opacity:0;}
        }

        /* Оверлей по истечении N минут */
        .overlay {
            position: fixed;
            top:0; left:0;
            width:100%; height:100%;
            background: rgba(0,0,0,0.8);
            color:#fff;
            flex-direction: column;
            justify-content: center;
            align-items:center;
            text-align:center;
            z-index:999;
            padding:20px;
            box-sizing:border-box;
            display:none;
        }

        .overlay h1 {
            margin-bottom:20px;
        }

        .overlay button {
            margin:10px;
            padding:10px 20px;
            background:#fff;
            color:#000;
            border:none;
            cursor:pointer;
            font-size:1em;
            border-radius:10px;
        }

        .overlay button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .overlay button.timer::after {
            content: attr(data-time);
            margin-left: 5px;
            font-size: 0.9em;
            color: #666;
        }

        /* Контейнер для фейерверков */
        #fireworksCanvas {
            position: fixed;
            top:0; left:0;
            width:100%; height:100%;
            z-index: 4;
            display:none;
        }

        /* Звёзды */
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            opacity: 0.5;
            animation: twinkle 2s infinite;
        }

        @keyframes twinkle {
            0%,100% { opacity:0.5; }
            50% {opacity:1;}
        }

        /* Анимация мигания для гирлянд */
        @keyframes blink {
            0%, 100% { opacity: 1; filter: brightness(1); }
            50% { opacity: 0.5; filter: brightness(0.5); }
        }

        .celebration-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            z-index: 4;
            text-align: center;
            width: 90%;
            max-width: 800px;
        }

        .celebration-message {
            color: #fff;
            font-size: 3em;
            text-shadow: 0 0 10px #fff;
            margin-bottom: 30px;
        }

        .year-text {
            font-size: 5em;
            font-weight: bold;
            background: linear-gradient(
                45deg,
                #ff0000,
                #ff4400,
                #ff8800,
                #ffcc00,
                #66ff00,
                #00ffff,
                #0088ff,
                #0000ff
            );
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 
                2px 2px 4px rgba(255,255,255,0.3),
                -2px -2px 4px rgba(255,255,255,0.3);
            animation: yearGlow 2s infinite alternate;
            white-space: nowrap;
        }

        /* Медиа-запросы для мобильных устройств */
        @media screen and (max-width: 768px) {
            .celebration-message {
                font-size: 2em;
                margin-bottom: 20px;
            }

            .year-text {
                font-size: 3.5em;
            }

            .credits-button {
                font-size: 1em;
                padding: 12px 24px;
                bottom: 30px;
                width: auto;
                max-width: 80%;
            }
        }

        @media screen and (max-width: 480px) {
            .celebration-message {
                font-size: 1.5em;
                margin-bottom: 15px;
            }

            .year-text {
                font-size: 2.5em;
            }

            .credits-button {
                font-size: 0.9em;
                padding: 10px 20px;
                bottom: 20px;
                width: auto;
                max-width: 70%;
            }
        }

        @keyframes yearGlow {
            0% {
                filter: brightness(1) blur(0px);
                transform: scale(1);
            }
            100% {
                filter: brightness(1.5) blur(1px);
                transform: scale(1.1);
            }
        }

        /* Стили для заблокированных кнопок */
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .self-destruct-button {
            background: linear-gradient(45deg, #ff4444, #ff0000);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: scale(0);
            }
        }

        .add-stars-button,
        .spawn-snowflakes-button,
        .bend-garlands-button,
        .reverse-spinner-button {
            background: linear-gradient(45deg, #4a90e2, #357abd);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: transform 0.2s;
            margin: 5px;
        }

        .add-stars-button:hover,
        .spawn-snowflakes-button:hover,
        .bend-garlands-button:hover,
        .reverse-spinner-button:hover,
        .self-destruct-button:hover {
            transform: scale(1.1);
        }

        @keyframes spinReverse {
            from { transform: rotate(360deg); }
            to { transform: rotate(0deg); }
        }

        /* Добавьте эти стили после .count-pop */
        @keyframes pulseRed {
            0% {
                transform: scale(1);
                background: rgba(255, 0, 0, 0.1);
                box-shadow: 0 0 10px rgba(255, 0, 0, 0.2);
            }
            50% {
                transform: scale(1.1);
                background: rgba(255, 0, 0, 0.2);
                box-shadow: 0 0 20px rgba(255, 0, 0, 0.4);
            }
            100% {
                transform: scale(1);
                background: rgba(255, 0, 0, 0.1);
                box-shadow: 0 0 10px rgba(255, 0, 0, 0.2);
            }
        }

        .snowflake-counter.inactive {
            animation: pulseRed 0.5s ease-in-out infinite;
        }

        /* Обновите стили для плавного перехода */
        .snowflake-counter {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1.2em;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .credits-button {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            font-size: 1.2em;
            background: linear-gradient(45deg, #feda4a, #FF8E00);
            color: #000;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
            display: none;
            text-decoration: none;
            text-align: center;
        }

        .credits-button:hover {
            transform: translateX(-50%) scale(1.1);
            box-shadow: 0 0 20px rgba(254, 218, 74, 0.5);
        }
    </style>
</head>
<body>
<div class="top-decoration" id="topDecoration"></div>
<div class="bottom-decoration" id="bottomDecoration"></div>

<div class="spinner" id="spinner"></div>
<div class="loading-text" id="loading-text">Подождите, поздравление загружается...</div>
<div class="progress-container" id="progress-container">
    <div class="progress-percentage" id="mainProgressPercent">0%</div>
    <div class="progress-bar-green" id="mainProgressBar"></div>
</div>

<div class="buttons-container" id="buttons-container">
    <button class="custom-button green-gradient" id="accelerateBtn">Ускорить загрузку</button>
    <button class="custom-button blue-gradient" id="accelerateBtn2">Тоже ускорить загрузку, но синего цвета</button>
    <button class="custom-button pink-gradient" id="changeColorBtn">Поменять цвет загрузки</button>
    <button class="custom-button green-gradient button-bounce" id="jumpBtn">Попрыгать</button>
    <button class="custom-button red-gradient" id="selfDestructBtn">Удалить лишнюю кнопку</button>
    <button class="custom-button yellow-gradient" id="addStarsBtn">Добавить звёзд на небо</button>
    <button class="custom-button green-gradient" id="bendGarlandsBtn">Перевесить гирлянды</button>
    <button class="custom-button blue-gradient" id="spawnSnowflakesBtn">Хочу больше снега!</button>
    <button class="custom-button orange-gradient" id="reverseSpinnerBtn">Почему не загружается?</button>
    <div class="accelerate-message" id="accelerateMsg">An error has occurred. Contact the administrator.</div>
</div>

<div class="status-bar">
    <div class="status-text" id="statusText">Подождите, поздравление загружается...</div>
    <div class="status-progress-container">
        <div class="status-progress-bar" id="statusProgress"></div>
    </div>
</div>

<div class="overlay" id="overlay">
    <h1>Слишком много поздравлений! Загрузить не получилось.</h1>
    <div>
        <button id="reloadBtn">Попробовать ещё раз</button>
        <button id="celebrateBtn">Всё равно порадоваться</button>
    </div>
</div>

<canvas id="fireworksCanvas"></canvas>
<div class="celebration-container" id="celebrationContainer">
    <div class="celebration-message" id="celebrationMsg">С Новым годом!</div>
    <div class="year-text" id="yearText">2025</div>
</div>

<div class="snowflake-counter">
    <span class="icon" style="cursor: pointer" id="postSnowFlakes">❄</span>
    <span class="count" id="snowflakeCount">0</span>
</div>

<script>
    let MAX_TIME = 5 * 60 * 1000; // 5 минут
    const startTime = Date.now();

    // Список фраз для нижнего статус-бара
    const phrases = [
        "%USERNAME% загружает новогоднее поздравление...",
        "%USERNAME% подготавливает персональный подарок...",
        "%USERNAME% калибрует волшебные снежинки...", 
        "%USERNAME% достает мандарины из тайных запасов...",
        "%USERNAME% упаковывает теплые пожелания от...",
        "%USERNAME% выпекает имбирные печеньки...",
        "%USERNAME% примеряет костюм Деда Мороза...",
        "%USERNAME% заправляет оленей сказочным топливом...",
        "%USERNAME% вычисляет радиус улыбки...",
        "%USERNAME% затягивает санки креативности...",
        "%USERNAME% греет мандаринки на батарее...",
        "%USERNAME% заворачивает настроение в блестящую упаковку...",
        "%USERNAME% сервирует праздничный стол...",
        "%USERNAME% генерирует конфетти из приятных слов...",
        "%USERNAME% наполняет бокал вдохновением...",
        "%USERNAME% запускает хоровод из теплых пожеланий...",
        "%USERNAME% подслащивает тёплый чай радостью...",
        "%USERNAME% открывает потайной сундук с добрыми словами...",
        "%USERNAME% сортирует искорки волшебства по яркости...",
        "%USERNAME% готовит сани с лета...",
        "%USERNAME% снял коньки с гвоздя...",
        "%USERNAME% настраивает частоту новогоднего настроения...",
        "%USERNAME% синхронизирует биоритмы с курантами...",
        "%USERNAME% компилирует праздничный код...",
        "%USERNAME% дефрагментирует новогоднее настроение...",
        "%USERNAME% калибрует громкость боя курантов...",
        "%USERNAME% пытается собрать оливье по инструкции...",
        "%USERNAME% считает пузырьки в шампанском...",
        "%USERNAME% настраивает резонансную частоту оливье...",
        "%USERNAME% проводит краш-тест подарочной упаковки...",
        "%USERNAME% оптимизирует траекторию полета Деда Мороза...",
        "%USERNAME% тестирует прочность новогодних обещаний...",
        "%USERNAME% упорядочивает снежинки в сугробе...",
    ];

    // Список имён (можно добавить больше)
    const usernames = [
        "Павел Аншуков",
        "Кирилл Асанов",
        "Евгений Березкин",
        "Вадим Бугримов",
        "Станислав Виниченко",
        "Максим Волконовский",
        "Александр Данилов",
        "Павел Деменин",
        "Андрей Евланов",
        "Дмитрий Евсюткин",
        "Дмитрий Егоров",
        "Алексей Егупов",
        "Вадим Зверев",
        "Ольга Зеленская",
        "Владимир Иванов",
        "Иван Изотов",
        "Ксения Капралова",
        "Дмитрий Карагодин",
        "Андрей Кардаш",
        "Алексей Карловский",
        "Денис Кельвин",
        "Владимир Колпаков",
        "Илья Копытов",
        "Сергей Кузнецов",
        "Владислав Лаврентьев",
        "Мария Лазаренко",
        "Дмитрий Лысаченко",
        "Александр Мурзинов",
        "Константин Мусалов",
        "Юрий Нарбеков",
        "Мария Осина",
        "Алексей Палиенко",
        "Алексей Перепелица",
        "Дмитрий Путилин",
        "Ирина Путилина",
        "Михаил Сандриков",
        "Александр Свищев",
        "Максим Скобаро",
        "Данила Слынько",
        "Андрей Смагин",
        "Марина Смолкина",
        "Денис Уткин",
        "Игорь Ушаков",
        "Дмитрий Хачидзе",
        "Владислав Храмченко",
        "Максим Яхин"
    ];

    function getRandomElement(arr) {
        const idx = Math.floor(Math.random() * arr.length);
        return arr[idx];
    }

    // Основной прогресс
    const bar = document.getElementById('mainProgressBar');
    const percText = document.getElementById('mainProgressPercent');
    function updateMainProgress() {
        let now = Date.now();
        let elapsedTime = now - startTime;
        
        // Рассчитываем прогресс на основе прошедшего времени
        let timeRatio = elapsedTime / MAX_TIME;
        if (timeRatio > 1) timeRatio = 1;
        let progress = 99 * (1 - Math.pow(1 - timeRatio, 20));
        
        // Убеждаемся, что не превысим 99%
        if (progress > 99) progress = 99;
        bar.style.width = progress + '%';
        percText.textContent = Math.floor(progress) + '%';
        
        if (elapsedTime > MAX_TIME) {
            // Показываем оверлей
            document.getElementById('overlay').style.display = 'flex';
            clearInterval(mainProgressInterval);
            return;
        }
    }
    const mainProgressInterval = setInterval(updateMainProgress, 200);

    const loadingText = document.getElementById('loading-text');
    const statusProgress = document.getElementById('statusProgress');

    function updateStatus() {
        const now = Date.now();
        if (now - startTime > MAX_TIME) {
            return;
        }

        // Выбираем рандомное время обновления от 3 до 5 сек
        const nextDelay = 3000 + Math.random() * 2000;

        let phrase = getRandomElement(phrases);
        let currentUsername = getRandomElement(usernames);
        phrase = phrase.replace('%USERNAME%', currentUsername);
        loadingText.textContent = phrase;

        // Сброс прогресса до 0%
        statusProgress.style.transition = 'none';
        statusProgress.style.width = '0%';

        // Чтобы применился сброс, перерисуем
        requestAnimationFrame(() => {
            // Теперь устанавливаем продолжительность анимации равную nextDelay
            statusProgress.style.transition = `width ${nextDelay}ms linear`;
            // И запускаем "заполнение"
            requestAnimationFrame(() => {
                statusProgress.style.width = '100%';
            });
        });

        // Планируем следующее обновление статуса
        setTimeout(updateStatus, nextDelay);
    }

    updateStatus();

    // Счётчик снежинок
    let snowflakeCount = parseInt(localStorage.getItem('snowflakeCount') || '0');
    const snowflakeCountElement = document.getElementById('snowflakeCount');
    // Инициализируем значение из localStorage
    snowflakeCountElement.textContent = snowflakeCount;

    // Отслеживание активности счетчика снежинок
    let lastSnowflakeTime = Date.now();
    let inactivityTimeout;
    const INACTIVITY_DELAY = 7000; // 7 секунд

    function checkSnowflakeInactivity() {
        const now = Date.now();
        if (now - lastSnowflakeTime > INACTIVITY_DELAY) {
            document.querySelector('.snowflake-counter').classList.add('inactive');
        }
    }

    // Обновляем функцию updateSnowflakeCount
    function updateSnowflakeCount() {
        snowflakeCount++;
        snowflakeCountElement.textContent = snowflakeCount;
        // Сохраняем новое значение в localStorage
        localStorage.setItem('snowflakeCount', snowflakeCount.toString());
        
        // Обновляем время последней активности
        lastSnowflakeTime = Date.now();
        
        // Убираем класс неактивности
        document.querySelector('.snowflake-counter').classList.remove('inactive');
        
        // Сбрасываем и устанавливаем новый таймер неактивности
        clearTimeout(inactivityTimeout);
        inactivityTimeout = setTimeout(checkSnowflakeInactivity, INACTIVITY_DELAY);
        
        // Анимация счетчика
        snowflakeCountElement.classList.remove('count-pop');
        void snowflakeCountElement.offsetWidth; // Сброс анимации
        snowflakeCountElement.classList.add('count-pop');
    }

    // Запускаем первичную проверку неактивности
    document.addEventListener('DOMContentLoaded', () => {
        inactivityTimeout = setTimeout(checkSnowflakeInactivity, INACTIVITY_DELAY);
    });

    function createSnowflake() {
        const snowflake = document.createElement('div');
        snowflake.classList.add('snowflake');
        snowflake.innerHTML = '❄';

        const size = Math.random() * 40 + 10;
        snowflake.style.fontSize = size + 'px';
        const left = Math.random() * 100;
        snowflake.style.left = left + 'vw';
        const duration = Math.random() * 20 + 5;
        snowflake.style.animationDuration = duration + 's';

        snowflake.addEventListener('click', () => {
            const rect = snowflake.getBoundingClientRect();
            snowflake.remove();
            const explosion = document.createElement('div');
            explosion.classList.add('explosion');
            explosion.style.left = rect.left + rect.width/2 + 'px';
            explosion.style.top = rect.top + rect.height/2 + 'px';
            document.body.appendChild(explosion);
            setTimeout(() => explosion.remove(), 500);
            updateSnowflakeCount(); // Обновляем счётчик
        });

        document.body.appendChild(snowflake);
        setTimeout(() => {
            if (snowflake.parentNode) snowflake.remove();
        }, duration * 1000);
    }

    setInterval(createSnowflake, 300);

    // Звезды - большее количество
    function createStar() {
        const star = document.createElement('div');
        star.classList.add('star');
        const x = Math.random() * 100;
        const y = Math.random() * 100;
        star.style.left = x + 'vw';
        star.style.top = y + 'vh';
        const duration = (Math.random()*2+1) + 's';
        star.style.animationDuration = duration;
        document.body.appendChild(star);
        setTimeout(() => {
            if (star.parentNode) star.remove();
        }, 15000);
    }

    for (let i=0; i<200; i++) {
        createStar();
    }
    setInterval(createStar, 1500);

    // Кнопка ускорения
    const accelerateBtn = document.getElementById('accelerateBtn');
    const accelerateMsg = document.getElementById('accelerateMsg');
    accelerateBtn.addEventListener('click', () => {
        accelerateMsg.style.display = 'block';
        setTimeout(() => {
            accelerateMsg.style.display = 'none';
        }, 2000);
    });
    const accelerateBtn2 = document.getElementById('accelerateBtn2');
    accelerateBtn2.addEventListener('click', () => {
        MAX_TIME -= (0.5 * 60 * 1000);
    });
    const changeColorBtn = document.getElementById('changeColorBtn');
    changeColorBtn.addEventListener('click', () => {
        const bar = document.getElementById('mainProgressBar');
        if (bar.classList.contains('progress-bar-green')) {
            bar.classList.replace('progress-bar-green', 'progress-bar-blue');
        } else if (bar.classList.contains('progress-bar-blue')) {
            bar.classList.replace('progress-bar-blue', 'progress-bar-yellow');
        } else if (bar.classList.contains('progress-bar-yellow')) {
            bar.classList.replace('progress-bar-yellow', 'progress-bar-red');
        } else if (bar.classList.contains('progress-bar-red')) {
            bar.classList.replace('progress-bar-red', 'progress-bar-green');
        }
    });

    const spinner = document.getElementById('spinner');
    const statusText = document.getElementById('statusText');
    const progressContainer = document.getElementById('progress-container');
    const buttonsContainer = document.getElementById('buttons-container');

    // Оверлей
    const overlay = document.getElementById('overlay');
    const reloadBtn = document.getElementById('reloadBtn');
    const celebrateBtn = document.getElementById('celebrateBtn');
    const fireworksCanvas = document.getElementById('fireworksCanvas');
    const celebrationMsg = document.getElementById('celebrationMsg');

    reloadBtn.addEventListener('click', () => {
        location.reload();
    });

    // Функция для обработки таймера на кнопке
    function startCelebrateBtnTimer() {
        let timeLeft = 3;
        celebrateBtn.disabled = true;
        celebrateBtn.classList.add('timer');
        celebrateBtn.setAttribute('data-time', `(${timeLeft})`);

        const timer = setInterval(() => {
            timeLeft--;
            celebrateBtn.setAttribute('data-time', `(${timeLeft})`);
            
            if (timeLeft <= 0) {
                clearInterval(timer);
                celebrateBtn.disabled = false;
                celebrateBtn.classList.remove('timer');
                celebrateBtn.removeAttribute('data-time');
            }
        }, 1000);
    }

    // Запускаем таймер при показе оверлея
    Object.defineProperty(overlay.style, 'display', {
        set: function(value) {
            this.cssText = `display: ${value}`;
            if (value === 'flex') {
                startCelebrateBtnTimer();
            }
        },
        get: function() {
            return this.cssText.replace('display: ', '');
        }
    });

    celebrateBtn.addEventListener('click', () => {
        overlay.style.display = 'none';
        spinner.style.display = 'none';
        loadingText.style.display = 'none';
        progressContainer.style.display = 'none';
        buttonsContainer.style.display = 'none';
        
        // Убираем статус-бар полностью
        document.querySelector('.status-bar').style.display = 'none';
        
        startFireworks();
        document.getElementById('celebrationContainer').style.display = 'block';

        // Показываем кнопку перехода к credits
        const creditsButton = document.createElement('a');
        creditsButton.href = 'credits.html';
        creditsButton.className = 'credits-button';
        creditsButton.textContent = 'Посмотреть титры';
        document.body.appendChild(creditsButton);
        creditsButton.style.display = 'block';
    });

    // Фейерверки
    const ctx = fireworksCanvas.getContext('2d');
    let fireworks = [];
    let lastTime = 0;

    function randomColor() {
        const r = Math.floor(Math.random()*255);
        const g = Math.floor(Math.random()*255);
        const b = Math.floor(Math.random()*255);
        return `rgb(${r},${g},${b})`;
    }

    function createFirework() {
        const x = Math.random()*window.innerWidth;
        const y = Math.random()*window.innerHeight/2;
        const particles = [];
        for (let i=0;i<30;i++){
            particles.push({
                x:x,
                y:y,
                vx: (Math.random()-0.5)*4,
                vy: (Math.random()-0.5)*4,
                color: randomColor(),
                life: 100
            });
        }
        fireworks.push(particles);
    }

    function updateFireworks() {
        ctx.clearRect(0,0,fireworksCanvas.width, fireworksCanvas.height);
        for (let i=0;i<fireworks.length;i++){
            const particles = fireworks[i];
            for (const element of particles) {
                const p = element;
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 5, 5); // Увеличил размер частиц с 2x2 до 5x5 пикселей
            }
            fireworks[i] = particles.filter(p=>p.life>0);
        }
        fireworks = fireworks.filter(f=>f.length>0);
    }

    function loopFireworks(timestamp) {
        if (!lastTime) lastTime=timestamp;
        const delta = timestamp - lastTime;
        if (delta > 500) { // новый фейерверк каждые 0.5 сек
            createFirework();
            lastTime=timestamp;
        }
        updateFireworks();
        requestAnimationFrame(loopFireworks);
    }

    function startFireworks() {
        fireworksCanvas.style.display = 'block';
        fireworksCanvas.width = window.innerWidth;
        fireworksCanvas.height = window.innerHeight;
        requestAnimationFrame(loopFireworks);
    }

    window.addEventListener('resize', () => {
        fireworksCanvas.width = window.innerWidth;
        fireworksCanvas.height = window.innerHeight;
    });

    // Генерация символов с дугообразным расположением
    const topDec = document.getElementById('topDecoration');
    const bottomDec = document.getElementById('bottomDecoration');

    // Функция для расчета оптимального количества символов
    function calculateSymbolCount() {
        const screenWidth = window.innerWidth;
        // Примерно один символ каждые 40 пикселей
        return Math.floor(screenWidth / 40);
    }

    // Функция генерации символов
    function generateSymbols(count) {
        const chars = ['❇', '✿', '❄', '⭐', '✨', '🎄', '🎁', '🔔', '✦'];
        const arr = [];
        for (let i=0; i<count; i++) {
            const el = document.createElement('span');
            el.textContent = getRandomElement(chars);
            el.style.color = randomBrightColor();
            el.style.fontSize = Math.random() < 0.5 ? '20px' : '30px';
            el.style.textShadow = `0 0 5px ${el.style.color}`;
            arr.push(el);
        }
        return arr;
    }

    // Функция обновления гирлянд
    function updateGarlands() {
        const symbolCount = calculateSymbolCount();
        const topSymbols = generateSymbols(symbolCount);
        const bottomSymbols = generateSymbols(symbolCount);
        
        // Очищаем существующие символы
        topDec.innerHTML = '';
        bottomDec.innerHTML = '';
        
        // Располагаем новые символы
        positionArcSymbols(topDec, topSymbols, 'down');
        positionArcSymbols(bottomDec, bottomSymbols, 'up');
    }

    // Обновление при изменении размера окна
    let resizeTimeout;
    window.addEventListener('resize', () => {
        // Используем debounce для оптимизации производительности
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(updateGarlands, 250);
    });

    // Случайный яркий цвет
    function randomBrightColor() {
        // Генерируем яркий цвет (увеличим вероятность ярких тонов)
        let r, g, b;
        do {
            r = Math.floor(Math.random()*256);
            g = Math.floor(Math.random()*256);
            b = Math.floor(Math.random()*256);
        } while ((r+g+b)<300); // пока сумма не будет достаточно большой (яркий цвет)
        return `rgb(${r},${g},${b})`;
    }

    
    // Увеличение амплитуды гирлянд
    let garlandAmplitude = 40;
    function increaseGarlandsBend() {
        garlandAmplitude += 10;
        if (garlandAmplitude > 120) garlandAmplitude = 40;
        updateGarlands();
    }

    // Инициализация гирлянд
    updateGarlands();

    // Располагаем символы дугой
    function positionArcSymbols(container, symbols, arcDirection='down') {
        // arcDirection = 'down' для верхней дуги, 'up' для нижней
        container.style.position = 'fixed';
        container.style.left = '0';
        container.style.height = '80px';
        container.style.width = '100%';
        container.style.overflow = 'visible';
        container.style.pointerEvents = 'none';
        container.style.position = 'fixed';

        const count = symbols.length;
        const containerWidth = window.innerWidth;
        // Базовый уровень и амплитуда дуги
        let baseY = 0;

        // Количество дуг (нечётное число)
        const numArcs = 5;
        
        for (let i = 0; i < count; i++) {
            const symbol = symbols[i];
            const norm = i / (count - 1);
            
            // Определяем, к какой дуге относится символ
            const arcIndex = Math.floor(norm * numArcs);
            // Нормализованная позиция внутри текущей дуги
            const arcNorm = (norm * numArcs) % 1;
            
            // Синусоида с несколькими периодами
            const sineVal = Math.sin(Math.PI * arcNorm);

            let topPos;
            if (arcDirection === 'down') {
                topPos = baseY + garlandAmplitude * sineVal;
            } else {
                topPos = baseY - garlandAmplitude * sineVal;
            }

            const segmentWidth = containerWidth / numArcs;
            const leftPos = (arcIndex * segmentWidth) + (arcNorm * segmentWidth);
            
            symbol.style.position = 'absolute';
            symbol.style.top = topPos + 'px';
            symbol.style.left = leftPos + 'px';
            container.appendChild(symbol);
        }
    }

    // Добавляем кнопку сброса при наведении
    const snowflakeCounter = document.querySelector('.snowflake-counter');
    const resetButton = document.createElement('button');
    resetButton.innerHTML = '↺';
    resetButton.style.cssText = `
        display: none;
        background: none;
        border: none;
        color: white;
        font-size: 1.2em;
        cursor: pointer;
        padding: 0 0 0 10px;
        transition: transform 0.3s;
    `;
    resetButton.addEventListener('click', (e) => {
        e.stopPropagation();
        resetSnowFlakeCount();
        resetButton.style.transform = 'rotate(360deg)';
    });
    snowflakeCounter.appendChild(resetButton);

    snowflakeCounter.addEventListener('mouseenter', () => {
        resetButton.style.display = 'block';
    });
    snowflakeCounter.addEventListener('mouseleave', () => {
        resetButton.style.display = 'none';
    });

    // Отправляем снежинки на бэкенд
    const postSnowFlakeBtn = document.getElementById('postSnowFlakes');
    postSnowFlakeBtn.addEventListener('click', () => {
        const name = prompt("Хотите отправить собранные снежинки? Нужно представиться:");
        const asyncPostCall = async () => {
            try {
                const response = await fetch('https://functions.yandexcloud.net/d4ecqkmrugqls3jbh3f6', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: JSON.stringify({
                        name: name,
                        score: snowflakeCount
                    })
                });
                resetSnowFlakeCount();
                await response;
            } catch(error) {
                console.log(error)
            }
        }
        asyncPostCall();
    })

    function resetSnowFlakeCount() {
        snowflakeCount = 0;
        snowflakeCountElement.textContent = '0';
        localStorage.setItem('snowflakeCount', '0');
    }

    // Функция для блокировки/разблокировки кнопки
    function toggleButtonState(button, duration) {
        button.disabled = true;
        setTimeout(() => {
            button.disabled = false;
        }, duration);
    }

    document.getElementById('jumpBtn').addEventListener('click', (e) => {
        const button = e.target;
        toggleButtonState(button, 2000);

        const elements = document.querySelectorAll('.progress-container, .loading-text, .spinner');
        elements.forEach(element => {
            element.style.animation = 'bounce 0.5s ease infinite';
            setTimeout(() => {
                element.style.animation = '';
            }, 2000);
        });
    });

    // Функция самоуничтожения кнопки
    function selfDestruct(button) {
        const rect = button.getBoundingClientRect();
        const explosion = document.createElement('div');
        explosion.classList.add('explosion');
        explosion.style.left = (rect.left + rect.width/2) + 'px';
        explosion.style.top = (rect.top + rect.height/2) + 'px';
        document.body.appendChild(explosion);
        
        button.style.animation = 'fadeOut 0.5s forwards';
        setTimeout(() => {
            button.remove();
            explosion.remove();
        }, 500);
    }

    // Функция добавления звёзд
    function addMoreStars() {
        for (let i = 0; i < 20; i++) {
            createStar();
        }
    }

    // Функция массового создания снежинок
    function spawnSnowflakes() {
        for (let i = 0; i < 20; i++) {
            setTimeout(() => createSnowflake(), i * 50);
        }
    }

    // Реверс спиннера
    let isSpinnerReversed = false;
    function reverseSpinner() {
        const spinner = document.getElementById('spinner');
        isSpinnerReversed = !isSpinnerReversed;
        
        if (isSpinnerReversed) {
            spinner.style.animation = 'spinReverse 1s linear infinite';
        } else {
            spinner.style.animation = 'spin 1s linear infinite';
        }

        // change spinner size to random
        spinner.style.width = Math.random() * 100 + 50 + 'px';
        spinner.style.height = spinner.style.width;
        
        // change spinner border width to random
        spinner.style.borderWidth = Math.random() * 10 + 5 + 'px';

        // change spinner color to random
        spinner.style.borderColor = `#${Math.floor(Math.random()*16777215).toString(16)}`;
        spinner.style.color = `#${Math.floor(Math.random()*16777215).toString(16)}`;

        // change spinner border style to random
        spinner.style.borderStyle = ['solid', 'dashed', 'dotted', 'double', 'groove', 'ridge', 'inset', 'outset'][Math.floor(Math.random() * 8)];

        // change spinner animation timing function to random
        spinner.style.animationTimingFunction = ['ease', 'ease-in', 'ease-out', 'ease-in-out', 'linear', 'cubic-bezier(0.1, 0.7, 0.1, 1)', 'cubic-bezier(0.8, 0, 0.2, 1)', 'cubic-bezier(0.2, 0, 0.8, 1)'][Math.floor(Math.random() * 8)];
    }

    // Инициализация обработчиков событий
    document.addEventListener('DOMContentLoaded', function() {
        // Существующие обработчики
        const accelerateBtn = document.getElementById('accelerateBtn');
        const accelerateBtn2 = document.getElementById('accelerateBtn2');
        const changeColorBtn = document.getElementById('changeColorBtn');
        const jumpBtn = document.getElementById('jumpBtn');
        
        // Новые обработчики
        const selfDestructBtn = document.getElementById('selfDestructBtn');
        const addStarsBtn = document.getElementById('addStarsBtn');
        const spawnSnowflakesBtn = document.getElementById('spawnSnowflakesBtn');
        const bendGarlandsBtn = document.getElementById('bendGarlandsBtn');
        const reverseSpinnerBtn = document.getElementById('reverseSpinnerBtn');

        // Добавляем обработчики для новых кнопок
        selfDestructBtn.addEventListener('click', function() {
            selfDestruct(this);
        });

        addStarsBtn.addEventListener('click', addMoreStars);
        spawnSnowflakesBtn.addEventListener('click', spawnSnowflakes);
        bendGarlandsBtn.addEventListener('click', increaseGarlandsBend);
        reverseSpinnerBtn.addEventListener('click', reverseSpinner);
    });

    // Функция для перемешивания массива (алгоритм Фишера-Йетса)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // Функция для перемешивания и скрытия кнопок
    function randomizeButtons() {
        const buttonsContainer = document.getElementById('buttons-container');
        const buttons = Array.from(buttonsContainer.children);
        
        // Перемешиваем кнопки
        const shuffledButtons = shuffleArray(buttons);
        
        // Определяем количество кнопок для скрытия (треть от общего количества)
        const hideCount = Math.floor(buttons.length / 3);
        
        // Скрываем случайные кнопки и переставляем все кнопки в случайном порядке
        shuffledButtons.forEach((button, index) => {
            // Скрываем первую треть кнопок после перемешивания
            if (index < hideCount) {
                button.style.display = 'none';
            }
            // Перемещаем кнопку в конец контейнера (это изменит порядок)
            buttonsContainer.appendChild(button);
        });
    }

    // Вызываем функцию при загрузке страницы
    document.addEventListener('DOMContentLoaded', randomizeButtons);

    function play() {
        try {
            new Audio("https://raw.githubusercontent.com/vasilykg/BoundlessCelebration/refs/heads/main/resources/wooden-door-knock-102902.mp3").play();
        }
        catch (e) {}
    }

    (function scheduleSurprise(multiplier) {
		if (multiplier === undefined)
			multiplier = 1;
        const delay = Math.floor(Math.random() * 60_000) + 60_000 * multiplier;
        setTimeout(() => { play(); scheduleSurprise(multiplier + 2); }, delay);
    })();
	
</script>
</body>
</html>
